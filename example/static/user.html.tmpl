<!doctype html>
<html lang="en-US">
  <head>
    {{ template "header.html.tmpl" }}
  </head>
  <body>
    <div id="user">
	  <h1>WebAuthn example app</h1>
	  <h2>Hello, {{.Username}}</h2>
      <dialog id="reauth-dialog">
        <h3>Success</h3>
        <div class="passkey-info-element">
          <div>Challenge</div>
          <div id="reauth-challenge" class="reauth-element-data"></div>
          <div>Client data</div>
          <div id="reauth-client-data" class="reauth-element-data"></div>
          <div>Authenticator data</div>
          <div id="reauth-auth-data" class="reauth-element-data"></div>
          <div>Signature</div>
          <div id="reauth-signature" class="reauth-element-data"></div>
          <div>User handle</div>
          <div id="reauth-user-handle" class="reauth-element-data"></div>
        </div>
        <form method="dialog">
         <button>OK</button>
        </form>
      </dialog>
	  <h2>Passkeys</h2>
      <p>Passkeys associated with your account.</p>
      <div class="passkeys">
        {{ range .Passkeys }}
        <div class="passkey">
          <span class="passkey-menu material-symbols-outlined">menu</span>
          <div class="passkey-name">{{ .Name }}</div>
          <div class="passkey-date">Added <div class="registered_at" value="{{ .CreatedAt }}"></div></div>
		  <div class="passkey-info">
            <div class="passkey-info-element">
              <div>ID</div>
              <div class="passkey-info-element-data">{{ .ID }}</div>
            </div>
            <div class="passkey-info-element">
              <div>Status</div>
              <div class="passkey-info-element-data">
                {{ if .BackedUp }}Backed up{{ else }}Not backed up{{ end }}
              </div>
            </div>
            <div class="passkey-info-element">
              <div>Transport</div>
              <div class="passkey-info-element-data">
                {{ range .Transports }}{{ . }} {{end}}
              </div>
            </div>
            <div class="passkey-info-element">
              <div>Client data</div>
              <div class="passkey-info-element-data">{{ .ClientData }}</div>
            </div>
            <div class="passkey-info-element">
              <div>Public key</div>
              <div class="passkey-info-element-data">
                {{ .Algorithm }}<br>
                {{ .Public }}
              </div>
            </div>
            <div class="passkey-info-element">
              <div>Attestation object</div>
              <div class="passkey-info-element-data">
                {{ .AttestationFormat }}<br>
                {{ .AttestationObject }}
              </div>
            </div>
          </div>
        </div>
        {{ end }}
      </div>
	  <button type="button" onclick="appRegisterKey()">Add passkey</button>
	  <h2>Reauth</h2>
      <p>Challenge your passkeys.</p>
      <button type="button", onclick="appReauth()">Reauthenticate</button>
	  <h2>Logout</h2>
      <a href="/logout">
        <button>Logout</button>
      </a>
      <div id="error">
       <span class="material-icons" onclick="appHideError()">
        close
       </span>
       <p id="errortext"></p>
      </div>
    </div>
  </body>
</html>
